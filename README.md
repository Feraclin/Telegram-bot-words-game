#   Описание проекта "Telegram бот на AIOhttp для игры в Слова"
Данный проект представляет собой Telegram бота, который использует бэкэнд на AIOhttp и состоит из четырех сущностей: poller, worker, sender и aiohttp_web.

Бот имеет следующие команды:

+ /play - начать игру
+ /stop - остановить игру
+ /stat - показать статистику игры
+ /ping - проверить доступность бота
+ /help - показать справку по командам
+ /last - показать на какую букву город
+ /FAQ - показать правила игры

Бот имеет два режима игры:

1. Для персональной беседы - игра в города

        Простой вариант игры в города бот против игрока
2. Для групповой беседы - игра в слова

        Бот не играет. В начале собирается команда игроков время на сбор 10 секунд.
        Далее бот случайно выбирает первого игрока и предлагает назвать ему любой слово. 
        Слово проверяется на существование в словаре и если существует то игроку, зачисляется бал, если слова нет в словаре, 
        то оно выставляется на голосование. По умолчанию голосовать могут все участники чата. Далее либо в случае положительного 
        результат игрок получает бал, в случае отрицательного теряет жизнь. У каждого игрока со старта 3 жизни. 
        Когда игрок теряет все жизни он выбывает из игры. Когда остается последний игрок он играет пока не закончатся жизни после чего игра заканчивается.
# Сущности
## Poller
Poller отвечает за получение сообщений из очереди RabbitMQ. Он принимает сообщения и передает их на обработку соответствующим сущностям.

## Worker
Worker получает сообщения от Poller и обрабатывает их. Он может выполнять различные действия в зависимости от типа сообщения. Например, он может выбирать лидера игры, обновлять статистику игры или удалять жизни у игроков.

## Sender
Sender отвечает за отправку сообщений пользователям. Он получает сообщения от других сущностей и отправляет их пользователям в Telegram.

## Aiohttp_web
Aiohttp_web представляет собой веб-интерфейс для управления ботом. Он позволяет администраторам бота просматривать статистику игры и управлять ею.

## Установка и запуск
Для установки и запуска проекта необходимо выполнить следующие шаги:

Склонировать репозиторий проекта

Установить зависимости, выполнив команду poetry install
Для игры в города требуется база городов скрипт расположен app/store/database/city.sql

Запустить бота, выполнив команду python main.py в виде монолита, либо собрать в docker-compose.yml


### миграции
```python
poetry run alembic revision --autogenerate -m "name"
poetry run alembic upgrade --head
```
### тестовое покрытие
```python
poetry run pytest --cov=app --cov-report=html --ignore=main*
```
### aiohttp-devtools
```python
poetry run adev runserver .
```
### RabbitMQ

Очереди:
```python
+ worker - tg_bot
+ sender - tg_bot_sender
```
Привязки
```python
+ tg_bot - poller, worker_self, worker
+ tg_bot_sender - sender
```

### Docker

Сборка builder:
```
docker build -t builder -f compose/builder.Dockerfile .
```